### 4.1 并发基础

并发优点
* 更客观的表现问题模型
* 可以充分利用CPU核心的优势，提高程序的执行效率
* 充分利用CPU与其他硬件设备固有的异步性

实现并发执行的方式模型
* 多进程
  >多进程是在**操作系统层面**进行并发的基本模式。同时也是**开销最大**的模式，因为所有进程都是**内核管理**。好处在于**简单**、**进程间互不影响**。

* 多线程
  >多线程在大部分操作系统上都属于**系统层面**的并发模式，也是使用最多最有效的一种模式。**比多进程的开销小很多**，但是其开销依旧比较大，且在**高并发模式下，效率会有影响**。

* 基于回调的非阻塞/异步IO
  >在很多高并发服务器开发实践中，使用多线程模式会很快耗尽服务器的内存和     CPU资源。而这种模式通过事件驱动的方式使用异步IO，使服务器持续运转，且尽可能的少用线程，降低开销，它目前在Node.js中得到了很好的实践。但是使用这种模式，编程比多线程要复杂，因为它把流程做了分隔，对于问题本身的反应不够自然。

* 协程
>协程（coroutine）本质上是一种**用户态线程**，不需要操作系统来进行抢占式调度，且在真正的实现中**寄存于线程中**。因此，**系统开销极少**，可以有效提高线程的任务并发性，而避免多线程的缺点。优点：**编程简单，结构清晰**；缺点：**需要语言的支持**，如果不支持，则需要用户在程序中自行实现调度器。目前，原生支持协程的语言还很少。

---

传统并发模型的缺陷：
* 共享内存系统：**线程之间的通信只能采用共享内存的方式**。为了保证共享内存的有效性，采用加锁等方式，但又带来**死锁**的可能。


* 消息传递系统：**对线程间共享状态的各种操作都被封装在线程之间传递的消息中**。要求：发送消息时对状态进行复制，并且在消息传递的边界上交出这个状态的所有权。从逻辑上看，这个操作与共享内存系统中执行的原子更新操作相同，但从物理上看则非常不同。由于需要执行复制操作，所以大多数消息传递的实现在性能上并不优越，但线程中的状态管理工作通常会变得更简单。

最早应用消息传递系统时由C.A.R.Hoare在Communicating Sequential Processes 中提出的。在CSP系统中，所有的并发操作都是通过独立线程以异步运行的方式来实现的。在这些线程必须通过彼此之间发送消息，从而向另一个线程请求信息或者将信息提供给另一个线程。使用类型CSP的系统将提高编程的抽象级别。